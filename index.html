<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>音声入力とリアルタイム翻訳</title>
</head>
<body>
  <h1>音声入力とリアルタイム翻訳</h1>
  <input type="text" x-webkit-speech id="webkitSpeech" onwebkitspeechchange="translate(this.value);" onkeyup="translate(this.value);" />
  <br>
  <div id="result"></div>

  <script src="https://www.google.com/jsapi"></script>
  <script>
    google.load("language", "1");
    var d = document;

    function translate(text) {
      var fromLang = d.getElementById("webkitSpeech").getAttribute('lang'),
          toLang = getToLang();

      google.language.translate(text, fromLang, toLang, function(result) {
        if (result.translation !== "" && result.error) {
          d.getElementById("result").innerHTML = "Error:" + result.message;
          return;
        }
        d.getElementById("result").innerHTML = result.translation;
      });
    }

    function getToLang() {
      var selectedLang = d.getElementsByName("lang"),
          len = selectedLang.length;
      for (var i = 0; i < len; i++) {
        if (selectedLang[i].checked) {
          return selectedLang[i].value;
        }
      }
      return d.getElementsByTagName('html')[0].getAttribute('lang');
    }
  </script>
</body>
</html>
